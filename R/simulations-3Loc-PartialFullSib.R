# Simulation code, 3 locus partial full-sib mating model

#' Here we present exact recursions for the frequency
#' of all possible mating types for the 3-locus genetic system
#' described in the main text (1 sex determining locus, 
#' 2 selected loci), and code to simulate the selective
#' advantage of a rare Y-linked inversion under different
#' selection scenarios.
#' 
#' The life cycle proceeds as follows: 
#'  fertilization --> mutation --> selection --> meiosis --> fertilization


# euclidian distance between two vectors (for checking equilibrium)
eucDist <- function(x1, x2) {
  sqrt(sum((x1 - x2)^2))
} 


##################################
##################################
#' Genetic Architecture
#' 
#' X -- A -- B
#' X -- A -- B
#'
#' X -- A -- B
#' Y -- A -- B
#' 
#' Recombination Rates
#' 
#' 	SDL << q >> A locus << r >> B locus
#' 
#' Mutation Rates
#' 
#' 	A locus: u
#'  B locus: v
#'
#' Genotypes
#' 
#' Female genotypes ... Fitness: ... Del. Mut. ... Het.Adv. 
#' XAB/XAB ... wx1  ... (1)*(1)             ... (1-s1)*(1-s2)
#' XAB/XAb ... wx2  ... (1)*(1-h2*s2)       ... (1-s1)*(1)
#' XAB/XaB ... wx3  ... (1-h1*s1)*(1)       ... (1)*(1-s2)
#' XAB/Xab ... wx4  ... (1-h1*s1)*(1-h2*s2) ... (1)*(1)
#' XAb/XAb ... wx5  ... (1)*(1-s2)          ... (1-s1)*(1-t2)
#' XAb/XaB ... wx6  ... (1-h1*s1)*(1-h2*s2) ... (1)*(1)
#' XAb/Xab ... wx7  ... (1-h1*s1)*(1-s2)    ... (1)*(1-t2)
#' XaB/XaB ... wx8  ... (1-s1)*(1)          ... (1-t1)*(1-s2)
#' XaB/Xab ... wx9  ... (1-s1)*(1-h2*s2)    ... (1-t1)*(1)
#' Xab/Xab ... wx10 ... (1-s1)*(1-s2)       ... (1-t1)*(1-t2)
#' 
#' Male Genotypes ... Fitness: ... Del. Mut. ... Het.Adv. 
#' XAB/YAB  ... y1      ... (1)*(1)             ... (1-s1)*(1-s2)
#' XAB/YAb  ... y2.c    ... (1)*(1-h2*s2)       ... (1-s1)*(1)
#' XAB/YAbI ... y2.cI   ... (1)*(1-h2*s2)       ... (1-s1)*(1)
#' XAB/YaB  ... y3c.    ... (1-h1*s1)*(1)       ... (1)*(1-s2)
#' XAB/Yab  ... y4cc    ... (1-h1*s1)*(1-h2*s2) ... (1)*(1)
#' XAB/YabI ... y4ccI   ... (1-h1*s1)*(1-h2*s2) ... (1)*(1)
#' XAb/YAB  ... y5.t    ... (1)*(1-h2*s2)       ... (1-s1)*(1)
#' XAb/YAb  ... y6..    ... (1)*(1-s2)          ... (1-s1)*(1-t2)
#' XAb/YAbI ... y6..I   ... (1)*(1-s2)          ... (1-s1)*(1-t2)
#' XAb/YaB  ... y7ct    ... (1-h1*s1)*(1-h2*s2) ... (1)*(1)
#' XAb/Yab  ... y8c.    ... (1-h1*s1)*(1-s2)    ... (1)*(1-t2)
#' XAb/YabI ... y8c.I   ... (1-h1*s1)*(1-s2)    ... (1)*(1-t2)
#' XaB/YAB  ... y9t.    ... (1-h1*s1)*(1)       ... (1)*(1-s2)
#' XaB/YAb  ... y10tc   ... (1-h1*s1)*(1-h2*s2) ... (1)*(1)
#' XaB/YAbI ... y10tcI  ... (1-h1*s1)*(1-h2*s2) ... (1)*(1)
#' XaB/YaB  ... y11..   ... (1-s1)*(1)          ... (1-t1)*(1-s2)
#' XaB/Yab  ... y12.c   ... (1-s1)*(1-h2*s2)    ... (1-t1)*(1)
#' XaB/YabI ... y12.cI  ... (1-s1)*(1-h2*s2)    ... (1-t1)*(1)
#' Xab/YAB  ... y13tt   ... (1-h1*s1)*(1-h2*s2) ... (1)*(1)
#' Xab/YAb  ... y14t.   ... (1-h1*s1)*(1-s2)    ... (1)*(1-t2)
#' Xab/YAbI ... y14t.I  ... (1-h1*s1)*(1-s2)    ... (1)*(1-t2)
#' Xab/YaB  ... y15.t   ... (1-s1)*(1-h2*s2)    ... (1-t1)*(1)
#' Xab/Yab  ... y16..   ... (1-s1)*(1-s2)       ... (1-t1)*(1-t2)
#' Xab/YabI ... y16..I  ... (1-s1)*(1-s2)       ... (1-t1)*(1-t2)

#' Mating combination frequencies
#' 
#' z1:	 XAB/XAB * XaB/YAB
#' z2:	 XAB/XAB * XaB/YAb
#' z3:	 XAB/XAB * XaB/YAbI
#' z4:	 XAB/XAB * Xab/YaB
#' z5:	 XAB/XAB * Xab/Yab
#' z6:	 XAB/XAB * Xab/YabI
#' z7:	 XAB/XAB * Xab/YAB
#' z8:	 XAB/XAB * Xab/YAb
#' z9:	 XAB/XAB * Xab/YAbI
#' z10:	 XAB/XAB * XAB/YaB
#' z11:	 XAB/XAB * XAB/Yab
#' z12:	 XAB/XAB * XAB/YabI
#' z13:	 XAB/XAB * XAB/YAB
#' z14:	 XAB/XAB * XAB/YAb
#' z15:	 XAB/XAB * XAB/YAbI
#' z..:  ....    * ....
#' z..:  ....    * ....
#' z..:  ....    * ....
#' z24: Xab/Xab * Xab/YabI
#' 
#' Vector of mating combination frequencies of length 240
#  c(z1,z2,z3,...,z240)

femaleGenotypesAfterMutation  <-  function(u,v) {

	matrix( c(
			  rep(c(((1-u)^2)*((1-v)^2), ((1-u)^2)*v*(1-v), u*(1-u)*((1-v)^2), u*(1-u)*v*(1-v), ((1-u)^2)*(v^2), u*(1-u)*v*(1-v), u*(1-u)*(v^2), (u^2)*((1-v)^2), (u^2)*v*(1-v), (u^2)*(v^2)), times=24),
			  rep(c(0, ((1-u)^2)*(1-v), 0, u*(1-u)*(1-v), ((1-u)^2)*v, 0, u*(1-u)*v, 0, (u^2)*(1-v), (u^2)*v), times=24),
			  rep(c(0, 0, (1-u)*(1-v)^2, (1-u)*(1-v)*v, 0, (1-u)*v*(1-v), (1-u)*v^2, u*(1-v)^2, u*(1-v)*v, u*v^2), times=24),
			  rep(c(0, 0, 0, (1-u)*(1-v), 0, 0, (1-u)*v^2, 0, u*(1-v), u*v), times=24),
			  rep(c(0, 0, 0, 0, (1-u)^2, 0, (1-u)*u, 0, 0, u^2), times=24),
			  rep(c(0, 0, 0, 0, 0, (1-u)*(1-v), (1-u)*v^2, 0, 0, u*v), times=24),
			  rep(c(0, 0, 0, 0, 0, 0, (1-u), 0, 0, u), times=24),
			  rep(c(0, 0, 0, 0, 0, 0, 0, (1-v)^2, (1-v)*v, v^2), times=24),
			  rep(c(0, 0, 0, 0, 0, 0, 0, 0, (1-v), v), times=24),
			  rep(c(0, 0, 0, 0, 0, 0, 0, 0, 0, 1), times=24)
			  ), ncol=10, byrow=TRUE)
}

maleGenotypesAfterMutation  <-  function(u,v) {

matrix( rep(c(
			  ((1-u)^2)*(1-v)^2, ((1-u)^2)*(1-v)*v, 0, (1-u)*u*(1-v)^2, (1-u)*u*(1-v)*v, 0, ((1-u)^2)*v*(1-v), ((1-u)^2)*v^2, 0, (1-u)*u*v*(1-v), (1-u)*u*v^2, 0, u*(1-u)*(1-v)^2, u*(1-u)*(1-v)*v, 0, (u^2)*(1-v)^2, (u^2)*(1-v)*v, 0, u*(1-u)*v*(1-v), u*(1-u)*v^2, 0, (u^2)*v*(1-v), (u^2)*v^2, 0,
			  0, ((1-u)^2)*(1-v), 0, 0, (1-u)*u*(1-v), 0, 0, ((1-u)^2)*v, 0, 0, (1-u)*u*v, 0, 0, u*(1-u)*(1-v), 0, 0, (u^2)*(1-v), 0, 0, u*(1-u)*v, 0, 0, (u^2)*v, 0,
			  0, 0, ((1-u)^2)*(1-v), 0, 0, (1-u)*u*(1-v), 0, 0, ((1-u)^2)*v, 0, 0, (1-u)*u*v, 0, 0, u*(1-u)*(1-v), 0, 0, (u^2)*(1-v), 0, 0, u*(1-u)*v, 0, 0, (u^2)*v,
			  0, 0, 0, (1-u)*(1-v)^2, (1-u)*(1-v)*v, 0, 0, 0, 0, (1-u)*v*(1-v), (1-u)*v^2, 0, 0, 0, 0, u*(1-v)^2, u*(1-v)*v, 0, 0, 0, 0, u*v*(1-v), u*v^2, 0,
			  0, 0, 0, 0, (1-u)*(1-v), 0, 0, 0, 0, 0, (1-u)*v, 0, 0, 0, 0, 0, u*(1-v), 0, 0, 0, 0, 0, u*v, 0,
			  0, 0, 0, 0, 0, (1-u)*(1-v), 0, 0, 0, 0, 0, (1-u)*v, 0, 0, 0, 0, 0, u*(1-v), 0, 0, 0, 0, 0, u*v,
			  0, 0, 0, 0, 0, 0, ((1-u)^2)*(1-v), ((1-u)^2)*v, 0, (1-u)*u*(1-v), (1-u)*u*v, 0, 0, 0, 0, 0, 0, 0, u*(1-u)*(1-v), u*(1-u)*v*(1-v), 0, (u^2)*(1-v), (u^2)*v*(1-v), 0,
			  0, 0, 0, 0, 0, 0, 0, (1-u)^2, 0, 0, (1-u)*u, 0, 0, 0, 0, 0, 0, 0, 0, u*(1-u), 0, 0, u^2, 0,
			  0, 0, 0, 0, 0, 0, 0, 0, (1-u)^2, 0, 0, (1-u)*u, 0, 0, 0, 0, 0, 0, 0, 0, u*(1-u), 0, 0, u^2,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, (1-u)*(1-v), (1-u)*v, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, u*(1-v), u*v, 0,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-u), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, u, 0,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-u), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, u,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-u)*(1-v)^2, (1-u)*(1-v)*v, 0, u*(1-v)^2, u*(1-v)*v, 0, (1-u)*v*(1-v), (1-u)*v^2, 0, u*v*(1-v), u*v^2, 0,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-u)*(1-v), 0, 0, u*(1-v), 0, 0, v*(1-u), 0, 0, v*u, 0,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-u)*(1-v), 0, 0, u*(1-v), 0, 0, (1-u)*v, 0, 0, u*v,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-v)^2, (1-v)*v, 0, 0, 0, 0, v*(1-v), v^2, 0,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-v), 0, 0, 0, 0, 0, v, 0,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-v), 0, 0, 0, 0, 0, v,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-u)*(1-v), (1-u)*v, 0, u*(1-v), u*v, 0,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-u), 0, 0, u, 0,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-u), 0, 0, u,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-v), v, 0,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0,
			  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1), times=10), ncol=24, byrow=TRUE)
}

u.matrix  <-  function(u,v) {

	fMut  <-  femaleGenotypesAfterMutation(u,v)
	mMut  <-  maleGenotypesAfterMutation(u,v)
	mateTypeMut  <-  matrix(0, nrow=240, ncol=240)

	for(i in 1:nrow(fMut)) {
		for(j in 1:ncol(fMut)) {
			for(k in 1:ncol(mMut)) {
				mateTypeMut[i, ((j-1)*ncol(mMut) + k)]  <-  fMut[i,j] * mMut[i,k]
			}
		}
	}
	mateTypeMut
}


#' Define female offspring frequency after meiosis & random mating
off.X.array  <-  function(q, r) {
	bigMat  <-  as.matrix(
		rbind(
			  c(1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((1-q)*(1-r)+(1-q)*r, 0, q*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((1-q)*(1-r), (1-q)*r, q*r, q*(1-r), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((1-q)*r, (1-q)*(1-r), q*(1-r), q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, (1-q)*(1-r)+(1-q)*r, 0, q*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*(1-r)+q*r, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*r, q*(1-r), (1-q)*(1-r), (1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*(1-r), q*r, (1-q)*r, (1-q)*(1-r), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, q*(1-r)+q*r, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(1/2, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(1/2, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(((1-q)*(1-r))/2, ((1-q)*r)/2, q*r/2, (q*(1-r))/2, ((1-q)*(1-r))/2, ((1-q)*r)/2, q*r/2, (q*(1-r))/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(1/2, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 1/2, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 1/2, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((1-q)*r/2, (1-q)*(1-r)/2, q*(1-r)/2, q*r/2, (1-q)*r/2, (1-q)*(1-r)/2, q*(1-r)/2, q*r/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 1/2, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*r/2, q*(1-r)/2, (1-q)*(1-r)/2, (1-q)*r/2, q*r/2, q*(1-r)/2, (1-q)*(1-r)/2, (1-q)*r/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*(1-r)/2, q*r/2, (1-q)*r/2, (1-q)*(1-r)/2, q*(1-r)/2, q*r/2, (1-q)*r/2, (1-q)*(1-r)/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 1/2, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 1/2, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 1/2, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0),
			  c(((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0),
			  c(1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0),
			  c(((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0),
			  c(((1-q)*(1-r))/2, ((1-q)*r)/2, q*r/2, (q*(1-r))/2, 0, 0, 0, 0, ((1-q)*(1-r))/2, ((1-q)*r)/2, q*r/2, (q*(1-r))/2, 0, 0, 0, 0),
			  c(1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0),
			  c((q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0),
			  c(0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0),
			  c(0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0),
			  c((1-q)*r/2, (1-q)*(1-r)/2, q*(1-r)/2, q*r/2, 0, 0, 0, 0, (1-q)*r/2, (1-q)*(1-r)/2, q*(1-r)/2, q*r/2, 0, 0, 0, 0),
			  c(0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0),
			  c(0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0),
			  c((q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0),
			  c(q*r/2, q*(1-r)/2, (1-q)*(1-r)/2, (1-q)*r/2, 0, 0, 0, 0, q*r/2, q*(1-r)/2, (1-q)*(1-r)/2, (1-q)*r/2, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0),
			  c(0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0),
			  c(q*(1-r)/2, q*r/2, (1-q)*r/2, (1-q)*(1-r)/2, 0, 0, 0, 0, q*(1-r)/2, q*r/2, (1-q)*r/2, (1-q)*(1-r)/2, 0, 0, 0, 0),
			  c(0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0),
			  c(0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0),
			  c(0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0),
			  c(0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0),
			  c(0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0),
			  c(1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0),
			  c(((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0),
			  c(1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0),
			  c(((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0),
			  c(((1-q)*(1-r))/4, ((1-q)*r)/4, q*r/4, (q*(1-r))/4, ((1-q)*(1-r))/4, ((1-q)*r)/4, q*r/4, (q*(1-r))/4, ((1-q)*(1-r))/4, ((1-q)*r)/4, q*r/4, (q*(1-r))/4, ((1-q)*(1-r))/4, ((1-q)*r)/4, q*r/4, (q*(1-r))/4),
			  c(1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0),
			  c((q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0),
			  c(0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0),
			  c(0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0),
			  c((1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4),
			  c(0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4),
			  c(0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0),
			  c((q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0),
			  c(q*r/4, q*(1-r)/4, (1-q)*(1-r)/4, (1-q)*r/4, q*r/4, q*(1-r)/4, (1-q)*(1-r)/4, (1-q)*r/4, q*r/4, q*(1-r)/4, (1-q)*(1-r)/4, (1-q)*r/4, q*r/4, q*(1-r)/4, (1-q)*(1-r)/4, (1-q)*r/4),
			  c(0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0),
			  c(0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0),
			  c(0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4),
			  c(0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0),
			  c(q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4),
			  c(0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4),
			  c(0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4),
			  c(0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4),
			  c(0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4),
			  c(0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4),
			  c(0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, q*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, (1-q)*(1-r), (1-q)*r, q*r, q*(1-r), 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, (1-q)*r, (1-q)*(1-r), q*(1-r), q*r, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, q*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, q*(1-r)+q*r, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, q*r, q*(1-r), (1-q)*(1-r), (1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, q*(1-r), q*r, (1-q)*r, (1-q)*(1-r), 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, q*(1-r)+q*r, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0),
			  c(((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0),
			  c(1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0),
			  c(((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0),
			  c(((1-q)*(1-r))/4, ((1-q)*r)/4, q*r/4, (q*(1-r))/4, ((1-q)*(1-r))/4, ((1-q)*r)/4, q*r/4, (q*(1-r))/4, ((1-q)*(1-r))/4, ((1-q)*r)/4, q*r/4, (q*(1-r))/4, ((1-q)*(1-r))/4, ((1-q)*r)/4, q*r/4, (q*(1-r))/4),
			  c(1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0),
			  c((q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0),
			  c(0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0),
			  c(0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0),
			  c((1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4),
			  c(0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4),
			  c(0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0),
			  c((q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0),
			  c(q*r/4, q*(1-r)/4, (1-q)*(1-r)/4, (1-q)*r/4, q*r/4, q*(1-r)/4, (1-q)*(1-r)/4, (1-q)*r/4, q*r/4, q*(1-r)/4, (1-q)*(1-r)/4, (1-q)*r/4, q*r/4, q*(1-r)/4, (1-q)*(1-r)/4, (1-q)*r/4),
			  c(0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0),
			  c(0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0),
			  c(0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4),
			  c(0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0),
			  c(q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4, q*(1-r)/4, q*r/4, (1-q)*r/4, (1-q)*(1-r)/4),
			  c(0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, (q*(1-r)+q*r)/4, 0, ((1-q)*(1-r)+(1-q)*r)/4),
			  c(0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4),
			  c(0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4),
			  c(0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4),
			  c(0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4, 0, 0, 0, 1/4),
			  c(0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0),
			  c(0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0),
			  c(0, 0, 0, 0, ((1-q)*(1-r))/2, ((1-q)*r)/2, q*r/2, (q*(1-r))/2, 0, 0, 0, 0, ((1-q)*(1-r))/2, ((1-q)*r)/2, q*r/2, (q*(1-r))/2),
			  c(0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0),
			  c(0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0),
			  c(0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0),
			  c(0, 0, 0, 0, (1-q)*r/2, (1-q)*(1-r)/2, q*(1-r)/2, q*r/2, 0, 0, 0, 0, (1-q)*r/2, (1-q)*(1-r)/2, q*(1-r)/2, q*r/2),
			  c(0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2),
			  c(0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0),
			  c(0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0),
			  c(0, 0, 0, 0, q*r/2, q*(1-r)/2, (1-q)*(1-r)/2, (1-q)*r/2, 0, 0, 0, 0, q*r/2, q*(1-r)/2, (1-q)*(1-r)/2, (1-q)*r/2),
			  c(0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0),
			  c(0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0),
			  c(0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2),
			  c(0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2, 0),
			  c(0, 0, 0, 0, q*(1-r)/2, q*r/2, (1-q)*r/2, (1-q)*(1-r)/2, 0, 0, 0, 0, q*(1-r)/2, q*r/2, (1-q)*r/2, (1-q)*(1-r)/2),
			  c(0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2),
			  c(0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2),
			  c(0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, q*(1-r)+q*r, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r), (1-q)*r, q*r, q*(1-r), 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, (1-q)*r, (1-q)*(1-r), q*(1-r), q*r, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, q*(1-r)+q*r, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+q*r, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, q*r, q*(1-r), (1-q)*(1-r), (1-q)*r, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, q*(1-r), q*r, (1-q)*r, (1-q)*(1-r), 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+q*r, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r))/2, ((1-q)*r)/2, q*r/2, (q*(1-r))/2, ((1-q)*(1-r))/2, ((1-q)*r)/2, q*r/2, (q*(1-r))/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 1/2, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 1/2, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, (1-q)*r/2, (1-q)*(1-r)/2, q*(1-r)/2, q*r/2, (1-q)*r/2, (1-q)*(1-r)/2, q*(1-r)/2, q*r/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 1/2, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, q*r/2, q*(1-r)/2, (1-q)*(1-r)/2, (1-q)*r/2, q*r/2, q*(1-r)/2, (1-q)*(1-r)/2, (1-q)*r/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 1/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 1/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 1/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)/2, q*r/2, (1-q)*r/2, (1-q)*(1-r)/2, q*(1-r)/2, q*r/2, (1-q)*r/2, (1-q)*(1-r)/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, (q*(1-r)+q*r)/2, 0, ((1-q)*(1-r)+(1-q)*r)/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, q*(1-r)+q*r, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r), (1-q)*r, q*r, q*(1-r)),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*r, (1-q)*(1-r), q*(1-r), q*r),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, q*(1-r)+q*r),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+q*r, 0, (1-q)*(1-r)+(1-q)*r, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*r, q*(1-r), (1-q)*(1-r), (1-q)*r),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r), q*r, (1-q)*r, (1-q)*(1-r)),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+q*r, 0, (1-q)*(1-r)+(1-q)*r),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1)
			)
		)

#	bigMat[,-c(5,9,10,13,14,15)]
	smallMat  <-  bigMat[,c(1,2,3,4,6,7,8,11,12,16)]
	smallMat[,2]  <-  smallMat[,2] + bigMat[,5]
	smallMat[,3]  <-  smallMat[,3] + bigMat[,9]
	smallMat[,4]  <-  smallMat[,4] + bigMat[,13]
	smallMat[,6]  <-  smallMat[,6] + bigMat[,10]
	smallMat[,7]  <-  smallMat[,7] + bigMat[,14]
	smallMat[,9]  <-  smallMat[,9] + bigMat[,15]
	return(smallMat)
}


#' Define male offspring frequency after meiosis & random mating
off.Y.array  <-  function(q, r) {
	as.matrix(
		rbind(
			  c(1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*(1-r)+q*r, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*(1-r), q*r, 0, (1-q)*r, (1-q)*(1-r), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*r, q*(1-r), 0, (1-q)*(1-r), (1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, q*(1-r)+q*r, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((1-q)*(1-r)+(1-q)*r, 0, 0, q*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((1-q)*r, (1-q)*(1-r), 0, q*(1-r), q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((1-q)*(1-r), (1-q)*r, 0, q*r, q*(1-r), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, (1-q)*(1-r)+(1-q)*r, 0, 0, q*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
 			  c(1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*(1-r)/2, q*r/2, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0, q*(1-r)/2, q*r/2, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*r/2, q*(1-r)/2, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0, q*r/2, q*(1-r)/2, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((1-q)*r/2, (1-q)*(1-r)/2, 0, q*(1-r)/2, q*r/2, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0, q*(1-r)/2, q*r/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((1-q)*(1-r)/2, (1-q)*r/2, 0, q*r/2, q*(1-r)/2, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0, q*r/2, q*(1-r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
 			  c(1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*(1-r)/2, q*r/2, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0, 0, 0, 0, 0, 0, 0, q*(1-r)/2, q*r/2, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0),
			  c(((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(q*r/2, q*(1-r)/2, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0, 0, 0, 0, 0, 0, 0, q*r/2, q*(1-r)/2, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0, 0, 0, 0, 0, 0, 0),
			  c(0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0),
			  c(((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c((1-q)*r/2, (1-q)*(1-r)/2, 0, q*(1-r)/2, q*r/2, 0, 0, 0, 0, 0, 0, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0, q*(1-r)/2, q*r/2, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0),
			  c((1-q)*(1-r)/2, (1-q)*r/2, 0, q*r/2, q*(1-r)/2, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0, q*r/2, q*(1-r)/2, 0, 0, 0, 0, 0, 0, 0),
			  c(0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0),
 			  c(1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0),
			  c((q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0),
			  c(0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0),
			  c((q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0),
			  c(q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0),
			  c(0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4),
			  c(((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0),
			  c(0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0),
			  c(0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0),
			  c(q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0),
			  c(0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0),
			  c(0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4),
			  c(((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0),
			  c((1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0),
			  c(0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0),
			  c(0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0),
			  c(0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0),
			  c(0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4),
			  c((1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0),
			  c(0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0),
			  c(0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0),
			  c(0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0),
			  c(0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0),
			  c(0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4),
			  c(0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, q*(1-r)+q*r, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, q*(1-r), q*r, 0, (1-q)*r, (1-q)*(1-r), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, q*r, q*(1-r), 0, (1-q)*(1-r), (1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, q*(1-r)+q*r, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, q*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, (1-q)*r, (1-q)*(1-r), 0, q*(1-r), q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, (1-q)*(1-r), (1-q)*r, 0, q*r, q*(1-r), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, q*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
 			  c(1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0),
			  c((q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0),
			  c(0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0),
			  c((q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0),
			  c(q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0),
			  c(0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4),
			  c(((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0),
			  c(0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0),
			  c(0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0),
			  c(q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0),
			  c(0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0),
			  c(0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4),
			  c(((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0),
			  c((1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0, (1-q)*r/4, (1-q)*(1-r)/4, 0, q*(1-r)/4, q*r/4, 0),
			  c(0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0),
			  c(0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0),
			  c(0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/4, ((1-q)*(1-r)+q*r)/4, 0),
			  c(0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4),
			  c((1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0, (1-q)*(1-r)/4, (1-q)*r/4, 0, q*r/4, q*(1-r)/4, 0),
			  c(0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0, 0, ((1-q)*(1-r)+(1-q)*r)/4, 0, 0, (q*(1-r)+q*r)/4, 0),
			  c(0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0),
			  c(0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/4, (q*(1-r)+(1-q)*r)/4, 0),
			  c(0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0),
			  c(0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4, 0, 0, 0, 0, 0, 1/4),
			  c(0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0),
			  c(0, 0, 0, 0, 0, 0, q*(1-r)/2, q*r/2, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0, 0, 0, 0, 0, 0, 0, q*(1-r)/2, q*r/2, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, q*r/2, q*(1-r)/2, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0, 0, 0, 0, 0, 0, 0, q*r/2, q*(1-r)/2, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0),
			  c(0, 0, 0, 0, 0, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0, q*(1-r)/2, q*r/2, 0, 0, 0, 0, 0, 0, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0, q*(1-r)/2, q*r/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0, q*r/2, q*(1-r)/2, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0, q*r/2, q*(1-r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+q*r, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r), q*r, 0, (1-q)*r, (1-q)*(1-r), 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*r, q*(1-r), 0, (1-q)*(1-r), (1-q)*r, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+q*r, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, q*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*r, (1-q)*(1-r), 0, q*(1-r), q*r, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r), (1-q)*r, 0, q*r, q*(1-r), 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, q*(1-r)+q*r, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)/2, q*r/2, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0, q*(1-r)/2, q*r/2, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*r/2, q*(1-r)/2, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0, q*r/2, q*(1-r)/2, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0, q*(1-r)/2, q*r/2, 0, (1-q)*r/2, (1-q)*(1-r)/2, 0, q*(1-r)/2, q*r/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0, 0, 0, 0, (q*(1-r)+(1-q)*r)/2, ((1-q)*(1-r)+q*r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0, q*r/2, q*(1-r)/2, 0, (1-q)*(1-r)/2, (1-q)*r/2, 0, q*r/2, q*(1-r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0, 0, ((1-q)*(1-r)+(1-q)*r)/2, 0, 0, (q*(1-r)+q*r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0, 0, 0, 0, ((1-q)*(1-r)+q*r)/2, (q*(1-r)+(1-q)*r)/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/2, 0, 0, 0, 0, 0, 1/2),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+q*r, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r), q*r, 0, (1-q)*r, (1-q)*(1-r), 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*r, q*(1-r), 0, (1-q)*(1-r), (1-q)*r, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+q*r, 0, 0, (1-q)*(1-r)+(1-q)*r, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, q*(1-r)+q*r, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*r, (1-q)*(1-r), 0, q*(1-r), q*r, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, q*(1-r)+(1-q)*r, (1-q)*(1-r)+q*r, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r), (1-q)*r, 0, q*r, q*(1-r), 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+(1-q)*r, 0, 0, q*(1-r)+q*r, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (1-q)*(1-r)+q*r, q*(1-r)+(1-q)*r, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0),
			  c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1)
			)
		)
}




#' Define sib-mating array (frequency of mating types resulting from 
#' full-sib matings)
#'	off.female   <-  daughtersRandomMating(q=1/2,r=1/2)
#'	off.male     <-  sonsRandomMating(q=1/2,r=1/2)
sib.Z.array  <-  function(off.female, off.male) {

	sib.Z.array  <-  matrix(0, nrow=240, ncol=240)

	for(i in 1:nrow(sib.Z.array)) {
		for(j in 1:ncol(off.female)) {
			for(k in 1:ncol(off.male)) {
				sib.Z.array[i, ((j-1)*ncol(off.male) + k)]  <-  off.female[i,j] * off.male[i,k]
			}
		}
	}
	sib.Z.array
}


#' Fitness Vectors
#' Wf  <-  c(wX1, wX2, w3, ... wx10)
#' Wm  <-  c(y1, y2.c, y2.cI, y3c., y4cc, y4ccI, 
#' 			 y5.t, y6.., y6..I, y7ct, y8c., y8c.I, 
#' 			 y9t., y10tc, y10tcI, y11.., y12.c, y12.cI, 
#' 			 y13tt, y14t., y14t.I, y15.t, y16.., y16..I)
#' Define vector of fitness expressions for each mating combination
Wvec  <-  function(Wf, Wm) {
	Wvec  <-  c()
	for(i in 1:length(Wf)) {
		for(j in 1:length(Wm)) {
			Wvec  <-  c(Wvec,Wf[i]*Wm[j])
		}
	}
	return(Wvec)
}




#' Recursion giving frequency of each mating type in the next generation
#' inverted  <-  seq_along(z.0) %% 3 == 0
#'z.0  <-  rep(1/(240 - sum(inverted)), times=240)
#'z.0[seq_along(z.0) %% 3 == 0]  <-  0 

Z.pr  <-  function(z, beta=0.15,
				   u=10^-5, v=10^-5, 
				   q=1/2, r=1/2, 
				   Wf, Wm,  ...) {

	# Step through the life-cycle
	# [1] Mutation 
	z.m  <-  z %*% u.matrix(u, v)

	# [2] [3] Selection, Meiosis, Mating,
	# Outcrossing
	off.female  <- off.X.array(q,r)
	off.male    <- off.Y.array(q,r) 
	# female offspring genotypic frequencies
	X  <-  z.m %*% off.female * Wf
	X  <-  X/norm(t(X), type="1")
	# male offspring genotypic frequencies
	Y  <-  z.m %*% off.male * Wm
	Y  <-  Y/norm(t(Y), type="1")
	# Outcross mating-type frequencies
	z.pr.out  <-  c()
	for(i in 1:length(X)) {
		for(j in 1:length(Y)) {
			z.pr.out  <-  c(z.pr.out, X[i]*Y[j])
		}
	}
	# Sib-mating
	z.pr.sib  <-  Wvec(Wf=Wf, Wm=Wm) * z.m %*% sib.Z.array(off.female=off.female, off.male=off.male)
	z.pr.sib  <-  z.pr.sib/norm(t(z.pr.sib), type="1")
	
	# [4] Overall mating-type frequencies in next generation
	z.pr  <-  (1 - beta)*z.pr.out + beta*z.pr.sib

	return(as.vector(z.pr))
}



#' Pared-down forward simulation of recursion equation to equilibrium
findEq  <-  function(threshold=10^-8, 
					 z.init, u=10^-5, v=10^-5, 
					 Wf, Wm, q=1/2, r=1/2, beta=0.15, ...) {

	# Define delta values to check eq.
	delta  <-  1

	# Forward simulation
	t  <-  1
	z  <-  z.init
# plot(z ~ rep((t-1), times=length(z.init)), xlim=c(0,1000), ylim=c(0,1), cex=0.1)
	while(delta >= threshold) {
		z.next      <-  Z.pr(z=z, u=u, v=v, Wf=Wf, Wm=Wm, q=q, r=r, beta=beta)
		delta       <-  eucDist(z.next, z)
		z           <-  z.next
		t           <-  t + 1
#points(z ~ rep((t-1), times=length(z.init)), cex=0.1)
# cat('\r', paste("Eq:", (delta/threshold)))
	}
	return(z)
}

#findEq(beta=0.1, z.init=z,u=u,v=v,q=q,r=r,Wf=Wf,Wm=Wm)




#' Forward simulation of recursion system to equilibrium
fwdRecSim  <-  function(generations = 1000, threshold=10^-8, 
						z.init, u=10^-5, v=10^-5, 
						Wf, Wm, q=1/2, r=1/2, beta=0.15, ...) {

	# Matrix to store frequencies
	outMat  <-  matrix(0, ncol=length(z.init), nrow=generations)
	# Define delta values to check eq.
	delta  <-  1

	# Forward simulation
	t  <-  1
	z  <-  z.init
	while(delta > threshold && t <= generations) {
		z.next      <-  Z.pr(z=z, u=u, v=v, Wf=Wf, Wm=Wm, q=q, r=r, beta=beta)
		delta       <-  eucDist(z.next, z)
		z           <-  z.next
		outMat[t,]  <-  z
		t           <-  t + 1
	}

	# trim output Matrix
	outMat  <-  outMat[rowSums(outMat) != 0,]

	# Calculate frequencies of interest
	Xfreqs  <-  cbind((rowSums(outMat[,1:24])),
					  (rowSums(outMat[,25:48])),
					  (rowSums(outMat[,49:72])),
					  (rowSums(outMat[,73:96])),
					  (rowSums(outMat[,97:120])),
					  (rowSums(outMat[,121:144])),
					  (rowSums(outMat[,145:168])),
					  (rowSums(outMat[,169:192])),
					  (rowSums(outMat[,192:216])),
					  (rowSums(outMat[,217:240]))
					  )
	Yfreqs  <-  cbind((rowSums(outMat[,c(1,  25, 49, 73, 97,  121, 145, 169, 193, 217)])),
					  (rowSums(outMat[,c(2,  26, 50, 74, 98,  122, 146, 170, 194, 218)])),
					  (rowSums(outMat[,c(3,  27, 51, 75, 99,  123, 147, 171, 195, 219)])),
					  (rowSums(outMat[,c(4,  28, 52, 76, 100, 124, 148, 172, 196, 220)])),
					  (rowSums(outMat[,c(5,  29, 53, 77, 101, 125, 149, 173, 197, 221)])),
					  (rowSums(outMat[,c(6,  30, 54, 78, 102, 126, 150, 174, 198, 222)])),
					  (rowSums(outMat[,c(7,  31, 55, 79, 103, 127, 151, 175, 199, 223)])),
					  (rowSums(outMat[,c(8,  32, 56, 80, 104, 128, 152, 176, 200, 224)])),
					  (rowSums(outMat[,c(9,  33, 57, 81, 105, 129, 153, 177, 201, 225)])),
					  (rowSums(outMat[,c(10, 34, 58, 82, 106, 130, 154, 178, 202, 226)])),
					  (rowSums(outMat[,c(11, 35, 59, 83, 107, 131, 155, 179, 203, 227)])),
					  (rowSums(outMat[,c(12, 36, 60, 84, 108, 132, 156, 180, 204, 228)])),
					  (rowSums(outMat[,c(13, 37, 61, 85, 109, 133, 157, 181, 205, 229)])),
					  (rowSums(outMat[,c(14, 38, 62, 86, 110, 134, 158, 182, 206, 230)])),
					  (rowSums(outMat[,c(15, 39, 63, 87, 111, 135, 159, 183, 207, 231)])),
					  (rowSums(outMat[,c(16, 40, 64, 88, 112, 136, 160, 184, 208, 232)])),
					  (rowSums(outMat[,c(17, 41, 65, 89, 113, 137, 161, 185, 209, 233)])),
					  (rowSums(outMat[,c(18, 42, 66, 90, 114, 138, 162, 186, 210, 234)])),
					  (rowSums(outMat[,c(19, 43, 67, 91, 115, 139, 163, 187, 211, 235)])),
					  (rowSums(outMat[,c(20, 44, 68, 92, 116, 140, 164, 188, 212, 236)])),
					  (rowSums(outMat[,c(21, 45, 69, 93, 117, 141, 165, 189, 213, 237)])),
					  (rowSums(outMat[,c(22, 46, 70, 94, 118, 142, 166, 190, 214, 238)])),
					  (rowSums(outMat[,c(23, 47, 71, 95, 119, 143, 167, 191, 215, 239)])),
					  (rowSums(outMat[,c(24, 48, 72, 96, 120, 144, 168, 192, 216, 240)]))
					  )
	aFreqX       <-  (Xfreqs[,3]/2) + (Xfreqs[,4]/2) + (Xfreqs[,6]/2) + (Xfreqs[,7]/2) + Xfreqs[,8] + Xfreqs[,9] + Xfreqs[,10]
	bFreqX       <-  (Xfreqs[,2]/2) + (Xfreqs[,4]/2) + (Xfreqs[,6]/2) + (Xfreqs[,9]/2) + Xfreqs[,5] + Xfreqs[,7] + Xfreqs[,10]
	dblHetFreqX  <-  ((Xfreqs[,4] + Xfreqs[,6])/2)
	aFreqY       <-  ((Yfreqs[,4] + Yfreqs[,5] + Yfreqs[,6] + Yfreqs[,10] + Yfreqs[,11] + Yfreqs[,12] + Yfreqs[,13] + Yfreqs[,14] + Yfreqs[,15] + Yfreqs[,19] + Yfreqs[,20] + Yfreqs[,21])/2) + Yfreqs[,16] + Yfreqs[,17] + Yfreqs[,18] + Yfreqs[,22] + Yfreqs[,23] + Yfreqs[,24]
	bFreqY       <-  ((Yfreqs[,2] + Yfreqs[,3] + Yfreqs[,5] + Yfreqs[,6] + Yfreqs[,7] + Yfreqs[,10] + Yfreqs[,14] + Yfreqs[,15] + Yfreqs[,17] + Yfreqs[,18] + Yfreqs[,19] + Yfreqs[,22])/2) + Yfreqs[,8] + Yfreqs[,9] + Yfreqs[,11] + Yfreqs[,12] + Yfreqs[,20] + Yfreqs[,21] + Yfreqs[,23] + Yfreqs[,24]
	dblHetFreqY  <-  ((Yfreqs[,5] + Yfreqs[,6] + Yfreqs[,10] + Yfreqs[,14] + Yfreqs[,15] + Yfreqs[,19])/2)
	aFreq        <-  (aFreqX + aFreqY)/2
	bFreq        <-  (bFreqX + bFreqY)/2
	dblHetFreq   <-  (dblHetFreqX + dblHetFreqY)/2
	invFreq      <-  Yfreqs[,3] + Yfreqs[,6] + Yfreqs[,9] + Yfreqs[,12] + Yfreqs[,15] + Yfreqs[,18] + Yfreqs[,21] + Yfreqs[,24]

	results  <-  list(
					  "outMat"       =  outMat,
					  "Xfreqs"       =  Xfreqs,
					  "Yfreqs"       =  Yfreqs,
					  "aFreqX"       =  aFreqX,
					  "bFreqX"       =  bFreqX,
					  "dblHetFreqX"  =  dblHetFreqX,
					  "aFreqY"       =  aFreqY,
					  "bFreqY"       =  bFreqY,
					  "dblHetFreqY"  =  dblHetFreqY,
					  "aFreq"        =  aFreq,
					  "bFreq"        =  bFreq,
					  "bFreq"        =  bFreq,
					  "dblHetFreq"   =  dblHetFreq,
					  "invFreq"      =  invFreq,
					  "z.eq"         =  outMat[nrow(outMat),]
					  )
	return(results)
}




#' Fast forward simulation of recursion equation to equilibrium
#' ends simulation when inversion reaches frequency of 0.01
fwdRecSimFast  <-  function(generations = 1000, invCutoff=0.01, threshold=10^-8, 
							z.init, u=10^-5, v=10^-5, 
							Wf, Wm, q=1/2, r=1/2, beta=0.15, ...) {

	# Matrix to store frequencies
	outMat  <-  matrix(0, ncol=length(z.init), nrow=generations)
	
	# Define inversion frequency to test against cutoff value
	invFreqTest  <-  invCutoff/10

	# Forward simulation
	t  <-  1
	z  <-  z.init
plot(0 ~ (t-1), xlim=c(0,generations), ylim=c(0,invCutoff))	
	while(invFreqTest <= invCutoff && invFreqTest > invCutoff/100 && t <= generations) {
		z.next      <-  Z.pr(z=z, u=u, v=v, Wf=Wf, Wm=Wm, q=q, r=r, beta=beta)
		invFreqTest <-  sum(z.next[seq(from=3,to=240, by=3)])
		z           <-  z.next
		outMat[t,]  <-  z
		t           <-  t + 1
points(invFreqTest ~ (t-1), xlim=c(0,generations), ylim=c(0,invCutoff))	
# cat('\r', paste("Invasion ratio:", (invFreqTest/invCutoff)))		
	}
	# trim output Matrix
	outMat  <-  outMat[rowSums(outMat) != 0,]

	# Calculate frequencies of interest
	Xfreqs  <-  cbind((rowSums(outMat[,1:24])),
					  (rowSums(outMat[,25:48])),
					  (rowSums(outMat[,49:72])),
					  (rowSums(outMat[,73:96])),
					  (rowSums(outMat[,97:120])),
					  (rowSums(outMat[,121:144])),
					  (rowSums(outMat[,145:168])),
					  (rowSums(outMat[,169:192])),
					  (rowSums(outMat[,192:216])),
					  (rowSums(outMat[,217:240]))
					  )
	Yfreqs  <-  cbind((rowSums(outMat[,c(1,  25, 49, 73, 97,  121, 145, 169, 193, 217)])),
					  (rowSums(outMat[,c(2,  26, 50, 74, 98,  122, 146, 170, 194, 218)])),
					  (rowSums(outMat[,c(3,  27, 51, 75, 99,  123, 147, 171, 195, 219)])),
					  (rowSums(outMat[,c(4,  28, 52, 76, 100, 124, 148, 172, 196, 220)])),
					  (rowSums(outMat[,c(5,  29, 53, 77, 101, 125, 149, 173, 197, 221)])),
					  (rowSums(outMat[,c(6,  30, 54, 78, 102, 126, 150, 174, 198, 222)])),
					  (rowSums(outMat[,c(7,  31, 55, 79, 103, 127, 151, 175, 199, 223)])),
					  (rowSums(outMat[,c(8,  32, 56, 80, 104, 128, 152, 176, 200, 224)])),
					  (rowSums(outMat[,c(9,  33, 57, 81, 105, 129, 153, 177, 201, 225)])),
					  (rowSums(outMat[,c(10, 34, 58, 82, 106, 130, 154, 178, 202, 226)])),
					  (rowSums(outMat[,c(11, 35, 59, 83, 107, 131, 155, 179, 203, 227)])),
					  (rowSums(outMat[,c(12, 36, 60, 84, 108, 132, 156, 180, 204, 228)])),
					  (rowSums(outMat[,c(13, 37, 61, 85, 109, 133, 157, 181, 205, 229)])),
					  (rowSums(outMat[,c(14, 38, 62, 86, 110, 134, 158, 182, 206, 230)])),
					  (rowSums(outMat[,c(15, 39, 63, 87, 111, 135, 159, 183, 207, 231)])),
					  (rowSums(outMat[,c(16, 40, 64, 88, 112, 136, 160, 184, 208, 232)])),
					  (rowSums(outMat[,c(17, 41, 65, 89, 113, 137, 161, 185, 209, 233)])),
					  (rowSums(outMat[,c(18, 42, 66, 90, 114, 138, 162, 186, 210, 234)])),
					  (rowSums(outMat[,c(19, 43, 67, 91, 115, 139, 163, 187, 211, 235)])),
					  (rowSums(outMat[,c(20, 44, 68, 92, 116, 140, 164, 188, 212, 236)])),
					  (rowSums(outMat[,c(21, 45, 69, 93, 117, 141, 165, 189, 213, 237)])),
					  (rowSums(outMat[,c(22, 46, 70, 94, 118, 142, 166, 190, 214, 238)])),
					  (rowSums(outMat[,c(23, 47, 71, 95, 119, 143, 167, 191, 215, 239)])),
					  (rowSums(outMat[,c(24, 48, 72, 96, 120, 144, 168, 192, 216, 240)]))
					  )
	aFreqX       <-  (Xfreqs[,3]/2) + (Xfreqs[,4]/2) + (Xfreqs[,6]/2) + (Xfreqs[,7]/2) + Xfreqs[,8] + Xfreqs[,9] + Xfreqs[,10]
	bFreqX       <-  (Xfreqs[,2]/2) + (Xfreqs[,4]/2) + (Xfreqs[,6]/2) + (Xfreqs[,9]/2) + Xfreqs[,5] + Xfreqs[,7] + Xfreqs[,10]
	dblHetFreqX  <-  ((Xfreqs[,4] + Xfreqs[,6])/2)
	aFreqY       <-  ((Yfreqs[,4] + Yfreqs[,5] + Yfreqs[,6] + Yfreqs[,10] + Yfreqs[,11] + Yfreqs[,12] + Yfreqs[,13] + Yfreqs[,14] + Yfreqs[,15] + Yfreqs[,19] + Yfreqs[,20] + Yfreqs[,21])/2) + Yfreqs[,16] + Yfreqs[,17] + Yfreqs[,18] + Yfreqs[,22] + Yfreqs[,23] + Yfreqs[,24]
	bFreqY       <-  ((Yfreqs[,2] + Yfreqs[,3] + Yfreqs[,5] + Yfreqs[,6] + Yfreqs[,7] + Yfreqs[,10] + Yfreqs[,14] + Yfreqs[,15] + Yfreqs[,17] + Yfreqs[,18] + Yfreqs[,19] + Yfreqs[,22])/2) + Yfreqs[,8] + Yfreqs[,9] + Yfreqs[,11] + Yfreqs[,12] + Yfreqs[,20] + Yfreqs[,21] + Yfreqs[,23] + Yfreqs[,24]
	dblHetFreqY  <-  ((Yfreqs[,5] + Yfreqs[,6] + Yfreqs[,10] + Yfreqs[,14] + Yfreqs[,15] + Yfreqs[,19])/2)
	aFreq        <-  (aFreqX + aFreqY)/2
	bFreq        <-  (bFreqX + bFreqY)/2
	dblHetFreq   <-  (dblHetFreqX + dblHetFreqY)/2
	invFreq      <-  Yfreqs[,3] + Yfreqs[,6] + Yfreqs[,9] + Yfreqs[,12] + Yfreqs[,15] + Yfreqs[,18] + Yfreqs[,21] + Yfreqs[,24]

	results  <-  list(
					  "outMat"       =  outMat,
					  "Xfreqs"       =  Xfreqs,
					  "Yfreqs"       =  Yfreqs,
					  "aFreqX"       =  aFreqX,
					  "bFreqX"       =  bFreqX,
					  "dblHetFreqX"  =  dblHetFreqX,
					  "aFreqY"       =  aFreqY,
					  "bFreqY"       =  bFreqY,
					  "dblHetFreqY"  =  dblHetFreqY,
					  "aFreq"        =  aFreq,
					  "bFreq"        =  bFreq,
					  "bFreq"        =  bFreq,
					  "dblHetFreq"   =  dblHetFreq,
					  "invFreq"      =  invFreq,
					  "z.eq"         =  outMat[nrow(outMat),]
					  )
	return(results)
}







#' Loop over selection & Sib-mating rates to produce 
#' similar plot as Charlesworth & Wall (1999) for
#' heterozygote advantage
make3LocusHetAdvSimData  <-  function(generations = 10000, threshold=10^-8, 
									  s.vals, t.vals, q, r) {
	# data storage
	invSelAdv  <-  c()

	# parameters
	betas  <-  c(0:9)/10
	u      <-  0
	v      <-  0

	# Define arbitrary initial
	# frequencies in absence of inversion
	inverted  <-  1:240 %% 3 == 0
	z.init    <-  rep(1/(240 - sum(inverted)), times=240)
	z.init[inverted]  <-  0 

	# progress counter
	count  <-  0
	total  <-  length(betas)*ncol(s.vals)
	cat('\r', paste("Progress:", round(100*(count/total)), "% complete"))

	# loop over parameters
	for(i in 1:length(betas)) {

		for(j in 1:ncol(s.vals)) {

			# Define fitness expressions for heterozygote Adv.
			sf1  <-  s.vals[1,j]
			sf2  <-  s.vals[2,j]
			tf1  <-  t.vals[1,j]
			tf2  <-  t.vals[2,j]
			sm1  <-  s.vals[1,j]
			sm2  <-  s.vals[2,j]
			tm1  <-  t.vals[1,j]
			tm2  <-  t.vals[2,j]
			Wf  <-  c((1-sf1)*(1-sf2),(1-sf1)*(1),(1)*(1-sf2),(1)*(1),(1-sf1)*(1-tf2),(1)*(1),(1)*(1-tf2),(1-tf1)*(1-sf2),(1-tf1)*(1),(1-tf1)*(1-tf2))
			Wm  <-  c((1-sm1)*(1-sm2),(1-sm1)*(1),(1-sm1)*(1),(1)*(1-sm2),(1)*(1),(1)*(1),(1-sm1)*(1),(1-sm1)*(1-tm2),(1-sm1)*(1-tm2),(1)*(1),(1)*(1-tm2),(1)*(1-tm2),(1)*(1-sm2),(1)*(1),(1)*(1),(1-tm1)*(1-sm2),(1-tm1)*(1),(1-tm1)*(1),(1)*(1),(1)*(1-tm2),(1)*(1-tm2),(1-tm1)*(1),(1-tm1)*(1-tm2),(1-tm1)*(1-tm2))

			# Find eq. z values in absence of inversion	
			z.eq  <-  findEq(z.init=z.init, u=u, v=v, Wf=Wf, Wm=Wm, q=q, r=r, beta=betas[i])

			# Introduce new inversion at 0.001 freq. Following Charlesworth & Wall,
			# introduce onto Xab/Yab male, at equal frequencies.
			z.intro     <-  z.eq
			inverted  <-  c(24,48,72,96,120,144,168,192,216,240)
#			if(!all(z.intro[inverted-1] > 0.001/length(inverted))){
#				inverted  <-  inverted[z.intro[inverted - 1] > 0.001/length(inverted)]
#			}
			for (m in inverted) {
				z.intro[(m-1)]  <-  z.intro[(m-1)] - (0.001/length(inverted))
				z.intro[m]      <-  z.intro[m] + (0.001/length(inverted))
			} 

			# Run forward simulation until inversion reaches freq. of 0.01,
			# or extinct
			res  <-  fwdRecSimFast(generations = generations, invCutoff=0.01, 
								   z.init=z.intro, u=u, v=v, Wf=Wf, Wm=Wm, 
								   q=q, r=r, beta=betas[i])

			# Calculate asymp. rate of increase in log() frequency of inversion
			rareLogInv  <-  log(res$invFreq)
			diff  <-  c()
			for(k in 10:length(rareLogInv)) {
				diff  <-  c(diff, rareLogInv[k] - rareLogInv[k-1])
			}
			invSelAdv  <-  c(invSelAdv, mean(diff))
			# update progress counter
			count  <-  count + 1
			cat('\r', paste("Progress:", round(100*(count/total)), "% complete"))

		}
	}
	beta  <-  rep(betas, each=ncol(s.vals))
	s1     <-  rep(s.vals[1,], times=length(betas))
	s2     <-  rep(s.vals[2,], times=length(betas))
	t1     <-  rep(t.vals[1,], times=length(betas))
	t2     <-  rep(t.vals[2,], times=length(betas))

	results  <-  as.data.frame(cbind(beta, s1, s2, t1, t2, invSelAdv))

	# Export data file for plotting
	filename  <-  paste("./data/3LocusHetAdvSimData_q", q, "_r", r, ".csv", sep="")
	write.csv(results, file=filename)
}




#' Loop over selection & Sib-mating rates to produce 
#' similar plot as Charlesworth & Wall (1999) for
#' heterozygote advantage
makeDataShelteringFig  <-  function(generations = 10000, threshold=10^-8, 
									hf.vals, sf.vals, hm.vals, sm.vals, 
									q.vals, r.vals, 
									u = 10^-5, v = 10^-5, filename) {
	# data storage
	invSelAdv  <-  c()

	# parameters
	betas  <-  c(0:9)/10

	# Define arbitrary initial
	# frequencies in absence of inversion
	inverted  <-  1:240 %% 3 == 0
	z.init    <-  c(0.95, rep(0.05*(1/(239 - sum(inverted))), times=239))
	z.init[inverted]  <-  0 

	# Progress counter
	count  <-  0
	total  <-  length(betas)*length(r.vals)*ncol(hf.vals)*ncol(sf.vals)
	cat('\r', paste("Progress:", round(100*(count/total)), "% complete"))

	# loop over parameters
	for(i in 1:length(betas)) {
		for(j in 1:length(r.vals)) {
			for(k in 1:ncol(hf.vals)) {
				for(l in 1:ncol(sf.vals)) {

					# Define fitness expressions for heterozygote Adv.
					hf1  <- hf.vals[1,k]
					hm1  <- hm.vals[1,k]
					sf1  <- sf.vals[1,l]
					sm1  <- sm.vals[1,l]
					hf2  <- hf.vals[2,k]
					hm2  <- hm.vals[2,k]
					sf2  <- sf.vals[2,l]
					sm2  <- sm.vals[2,l]
					Wf  <-  c((1)*(1),(1)*(1-hf2*sf2),(1-hf1*sf1)*(1),(1-hf1*sf1)*(1-hf2*sf2),(1)*(1-sf2),(1-hf1*sf1)*(1-hf2*sf2),(1-hf1*sf1)*(1-sf2),(1-sf1)*(1),(1-sf1)*(1-hf2*sf2),(1-sf1)*(1-sf2))
					Wm  <-  c((1)*(1),(1)*(1-hm2*sm2),(1)*(1-hm2*sm2),(1-hm1*sm1)*(1),(1-hm1*sm1)*(1-hm2*sm2),(1-hm1*sm1)*(1-hm2*sm2),(1)*(1-hm2*sm2),(1)*(1-sm2),(1)*(1-sm2),(1-hm1*sm1)*(1-hm2*sm2),(1-hm1*sm1)*(1-sm2),(1-hm1*sm1)*(1-sm2),(1-hm1*sm1)*(1),(1-hm1*sm1)*(1-hm2*sm2),(1-hm1*sm1)*(1-hm2*sm2),(1-sm1)*(1),(1-sm1)*(1-hm2*sm2),(1-sm1)*(1-hm2*sm2),(1-hm1*sm1)*(1-hm2*sm2),(1-hm1*sm1)*(1-sm2),(1-hm1*sm1)*(1-sm2),(1-sm1)*(1-hm2*sm2),(1-sm1)*(1-sm2),(1-sm1)*(1-sm2))

					# Find eq. z values in absence of inversion	
					z.eq  <-  findEq(z.init=z.init, u=u, v=v, Wf=Wf, Wm=Wm, q=q.vals[j], r=r.vals[j], beta=betas[i], threshold=10^-5)
		
					# Introduce new inversion at 0.001 freq. Following Charlesworth & Wall,
					# introduce onto Xab/Yab male, at equal frequencies.
					z.intro   <-  z.eq
					inverted  <-  c(3,27,51)
					for (m in inverted) {
						z.intro[(m-1)]  <-  z.intro[(m-1)] - (0.001/length(inverted))
						z.intro[m]      <-  z.intro[m] + (0.001/length(inverted))
					} 
		
					# Run forward simulation until inversion reaches freq. of 0.01,
					# or extinct
					res  <-  fwdRecSimFast(generations = generations, invCutoff=0.01, 
										   z.init=z.intro, u=u, v=v, Wf=Wf, Wm=Wm, 
										   q=q.vals[j], r=r.vals[j], beta=betas[i])
		
					# Calculate asymp. rate of increase in log() frequency of inversion
					rareLogInv  <-  log(res$invFreq)
					diff  <-  c()
					for(t in 2:length(rareLogInv)) {
						diff  <-  c(diff, rareLogInv[t] - rareLogInv[t-1])
					}
					invSelAdv  <-  c(invSelAdv, mean(diff))

					# progress counter
					count  <-  count + 1
					cat('\r', paste("Progress:", round(100*(count/total)), "% complete"))
				}
			}
		}
	}

	# Parameter vectors for plotting
	beta  <-  rep(betas, each=length(r.vals)*ncol(hf.vals)*ncol(sf.vals))
	q     <-  rep(rep(q.vals, each=ncol(hf.vals)*ncol(sf.vals)), times=length(betas))
	r     <-  rep(rep(r.vals, each=ncol(hf.vals)*ncol(sf.vals)), times=length(betas))
	hfA     <-  rep(rep(hf.vals[1,], each=ncol(sf.vals)), times=length(betas)*length(r.vals))
	hmA     <-  rep(rep(hm.vals[1,], each=ncol(sm.vals)), times=length(betas)*length(r.vals))
	hfB     <-  rep(rep(hf.vals[2,], each=ncol(sf.vals)), times=length(betas)*length(r.vals))
	hmB     <-  rep(rep(hm.vals[2,], each=ncol(sm.vals)), times=length(betas)*length(r.vals))
	sfA     <-  rep(sf.vals[1,], times=length(betas)*length(r.vals)*ncol(hf.vals))
	smA     <-  rep(sm.vals[1,], times=length(betas)*length(r.vals)*ncol(hm.vals))
	sfB     <-  rep(sf.vals[2,], times=length(betas)*length(r.vals)*ncol(hf.vals))
	smB     <-  rep(sm.vals[2,], times=length(betas)*length(r.vals)*ncol(hm.vals))

	# Make Dataframe
	results  <-  as.data.frame(cbind(beta, q, r, u, v, hfA, sfA, hmA, smA, hfB, sfB, hmB, smB, invSelAdv))

	# Export data file for plotting
	filename  <-  paste("./data/3LocusHetShelteringData_", filename, ".csv", sep="")
	write.csv(results, file=filename)
}
